name: PR Preview

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  preview:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 24
          cache: 'npm'

      - name: Install dependencies
        run: npm i

      - name: Build plugin
        run: npm run build

      - name: Post Playground Preview Button
        uses: WordPress/action-wp-playground-pr-preview@v2
        with:
          mode: "append-to-description"
          plugin-path: .
          blueprint: |
            {
              "landingPage": "/wp-admin/",
              "preferredVersions": {
                "php": "8.3",
                "wp": "6.8"
              },
              "steps": [
                {
                  "step": "login",
                  "username": "admin",
                  "password": "password"
                },
                {
                  "step": "installTheme",
                  "themeData": {
                    "resource": "wordpress.org/themes",
                    "slug": "twentytwentyfour"
                  },
                  "options": {
                    "activate": true
                  }
                }
              ]
            }
          github-token: ${{ secrets.GITHUB_TOKEN }}
